{"files":[{"id":"d73341ba-fecd-4393-8f77-d975861bd7e3","name":"コード","type":"server_js","source":"/**\n * Responds to a MESSAGE event in Hangouts Chat.\n *\n * @param {Object} event the event object from Hangouts Chat\n */\nfunction onMessage(event) {\n  var name \u003d \"\";\n  var message \u003d \"\";\n  var messageUrl \u003d \"\";\n  \n  if (event.space.type \u003d\u003d \"DM\") {\n    name \u003d \"You\";\n  } else {\n    name \u003d event.user.displayName;\n  }\n  // message \u003d name + \" said \\\"\" + event.message.text + \"\\\"\";\n  message \u003d getManualURL(event.message.text);\n  return { \"text\": message};\n  \n  }\n\n/**\n * Responds to an ADDED_TO_SPACE event in Hangouts Chat.\n *\n * @param {Object} event the event object from Hangouts Chat\n *//*\nfunction onAddToSpace(event) {\n  var message \u003d \"\";\n\n  if (event.space.type \u003d\u003d \"DM\") {\n    message \u003d \"Thank you for adding me to a DM, \" + event.user.displayName + \"!\";\n  } else {\n    message \u003d \"Thank you for adding me to \" + event.space.displayName;\n  }\n\n  if (event.message) {\n    // Bot added through @mention.\n    message \u003d message + \" and you said : \\\"\" + event.message.text + \"\\\"\";\n  }\n\n  return { \"text\": message };\n}\n\n/**\n * Responds to a REMOVED_FROM_SPACE event in Hangouts Chat.\n *\n * @param {Object} event the event object from Hangouts Chat\n */\nfunction onRemoveFromSpace(event) {\n  console.info(\"Bot removed from \", event.space.name);\n}\n\nfunction getManualURL(target) {\n  //var URL \u003d \"https://docs.google.com/spreadsheets/d/1X4UOyJL87Ghkp1PdIqWj0EBVd-Aop8t6VpctlRDndOo/edit#gid\u003d0\"//test\n  var URL \u003d \"https://docs.google.com/spreadsheets/d/14gF_mGaMyxqxowmRM9LTySC4jmbeDqpjdXLIOX6CLxY/edit#gid\u003d0\";\n  \n  var ss \u003d SpreadsheetApp.openByUrl(URL);\n  var Sheet \u003d ss.getActiveSheet();  \n   \n  // (1行目,1列目,　から　最終行,4列　を取得する)\n  var LastRow \u003d Sheet.getLastRow(); \n  var Range \u003d Sheet.getRange(1,1,LastRow,4);\n  var Values \u003d Range.getValues();\n  \n  //全件表示用URL\n  //var ALLISTURL \u003d \"https://docs.google.com/spreadsheets/d/1pyW_-keldEALlUMERMyVvTy-rdAs6xW_EciAyA739Ck/edit#gid\u003d0\";\n  var ALLISTURL \u003d \"https://docs.google.com/spreadsheets/d/14gF_mGaMyxqxowmRM9LTySC4jmbeDqpjdXLIOX6CLxY/edit#gid\u003d0\";\n  \n  var message \u003d \"検索結果：\"\n  var count \u003d0;\n  var andList \u003d [];\n  var Answer \u003d [];\n  var matchList \u003d [];\n\n   \n   //id検索、完全一致\n  if(target.match(/^#/)){\n    var id \u003d target;\n    for(var i \u003d 0; i\u003cLastRow; i++){\n      if(String(Values[i][0])\u003d\u003did){\n        message \u003d \"検索結果：\"\n        //代替テキストリンク付(蛇足)\n        //message \u003d message + \"\\n\" + String(Values[i][1]) + \"\\t\" +String(Values[i][2]);\n        message \u003d message + \"\\n\" + target + \":\" + \"\\t\" + \"\u003c\" + String(Values[i][2]) + \"|\" + String(Values[i][1]) + \"\u003e\";\n        break;\n      }else{\n        message \u003d \"IDが間違っています。お確かめの上再度入力してください\";\n        continue;\n      }\n    }\n    return message;\n    //全件表示\n  }else if(target \u003d\u003d \"全件表示\"){\n    \n    /*自動コピー　範囲指定がダメ　A1:C4~ とかだとうまいくいく\n    var OpenList \u003d SpreadsheetApp.openByUrl(AllListURL);\n    var OpenSheet \u003d OpenList.getActiveSheet();\n    //var LastRowOpen \u003d LastRow + 1;\n    var copyValue \u003d Sheet.getRange(\"A1:C4\").getValues();\n    OpenSheet.getRange(\"A2:C5\").setValues(copyValue);\n    //count++;*/\n    \n    message \u003d \"全件リストを表示します\" + \"\\n\" + ALLISTURL;\n    \n    return　message;\n    \n  }else{\n    //AND・単一統合\n    //検索ワードリスト\n    if(/\\s+/.test(target)){\n      andList \u003d target.split(/\\s+/);\n    }else{\n      andList.push(target);\n    }\n\n    for(var i \u003d0; i\u003cLastRow; i++){\n      //検索対象リストをつくる\n      var KeywordList \u003d String(Values[i][3]).split(\",\");\n      KeywordList.unshift(String(Values[i][1]));\n      \n      for(var l \u003d 0; l\u003candList.length; l++){\n        for(var h \u003d 0; h\u003cKeywordList.length; h++){\n          //判定\n          if(String(KeywordList[h]).indexOf(andList[l])\u003e-1){\n            //単一検索のとき\n            if(andList.length \u003d\u003d1){\n              Answer.push(i);  \n              var Res \u003d Answer.filter(function (x, y, self) {\n                return self.indexOf(x) \u003d\u003d\u003d y;});              \n             //And検索のとき\n            }else{\n              var Res \u003d Answer.filter(function (x, y, self) {\n                return self.indexOf(x) \u003d\u003d\u003d y;});\n              matchList.push(i);\n              Answer \u003d matchList.filter(function (e, f, self) {\n                return self.indexOf(e) \u003d\u003d\u003d f \u0026\u0026 f !\u003d\u003d self.lastIndexOf(e); });\n            }\n          }\n        }\n      }\n      continue;\n    }\n    \n    //配列の重複を削除(同じ項目に含まれる複数のキーワードがヒットしたとき用,表示項目が重複したとき用)\n    var messageAnswer \u003d Answer.filter(function (x, y, self) {\n      return self.indexOf(x) \u003d\u003d\u003d y;});\n    \n    //メッセージ処理\n    count \u003d messageAnswer.length;   \n    message \u003d message + count +\"件\"\n    if(count \u003e10){\n      message \u003d message + \"\\n\" +\"検索結果をIDで表示します\";\n      for(var q \u003d0; q\u003c messageAnswer.length; q++){\n        var j \u003d messageAnswer[q];\n        message \u003d message + \"\\n\"+ String(Values[j][0]) + \"\\t\" + String(Values[j][1]);\n      }\n    }else if(count \u003c 1){\n      message \u003d message;\n    }else{\n      \n      for(var q \u003d0; q\u003c messageAnswer.length; q++){\n        var j \u003d messageAnswer[q];\n        //message \u003d message + \"\\n\" + String(Values[j][1])+ \"\\n\" + String(Values[j][2]);}\n        //代替テキストリンク(蛇足)\n        message \u003d message + \"\\n\" + \"\u003c\" + String(Values[j][2]) + \"|\" + String(Values[j][1]) + \"\u003e\";}\n    }\n  }\n  return message;\n}"},{"id":"0c9aa94b-6dee-46e1-9aaf-6da9514698a6","name":"appsscript","type":"json","source":"{\n  \"timeZone\": \"Asia/Tokyo\",\n  \"dependencies\": {\n  },\n  \"exceptionLogging\": \"STACKDRIVER\",\n  \"chat\": {\n  }\n}"},{"id":"62fc1c01-0720-4b7c-84d9-efd4f830850c","name":"保管(1/24)","type":"server_js","source":"/**\n * Responds to a MESSAGE event in Hangouts Chat.\n *\n * @param {Object} event the event object from Hangouts Chat\n *//*\nfunction onMessage(event) {\n  var name \u003d \"\";\n  var message \u003d \"\";\n  \n  if (event.space.type \u003d\u003d \"DM\") {\n    name \u003d \"You\";\n  } else {\n    name \u003d event.user.displayName;\n  }\n  // message \u003d name + \" said \\\"\" + event.message.text + \"\\\"\";\n  message \u003d getManualURL(event.message.text);\n  return { \"text\": message };\n  \n  \n  /*蛇足:このままだとリンクが認識されない/メッセージに詰め込んだ返信が1個のカードにつめこまれて帰ってくる\n  return{\n    \"cards\":[\n      {\n        \"header\":{\n          \"title\":\"検索結果\",\n          //\"subtitle\":\"たぶんいける\"\n        },\n        \"sections\":[\n          {\n            \"widgets\":[\n              {\n                \"textParagraph\":{\n                  \"text\":message\n                }\n              }\n            ]\n          },\n        ]\n      } \n    ]\n  }*/\n  \n  \n  \n//  }\n\n/**\n * Responds to an ADDED_TO_SPACE event in Hangouts Chat.\n *\n * @param {Object} event the event object from Hangouts Chat\n *//*\nfunction onAddToSpace(event) {\n  var message \u003d \"\";\n\n  if (event.space.type \u003d\u003d \"DM\") {\n    message \u003d \"Thank you for adding me to a DM, \" + event.user.displayName + \"!\";\n  } else {\n    message \u003d \"Thank you for adding me to \" + event.space.displayName;\n  }\n\n  if (event.message) {\n    // Bot added through @mention.\n    message \u003d message + \" and you said : \\\"\" + event.message.text + \"\\\"\";\n  }\n\n  return { \"text\": message };\n}\n\n/**\n * Responds to a REMOVED_FROM_SPACE event in Hangouts Chat.\n *\n * @param {Object} event the event object from Hangouts Chat\n *//*\nfunction onRemoveFromSpace(event) {\n  console.info(\"Bot removed from \", event.space.name);\n}\n\n\n//ついでにカードで投げ返ｒｙ\n\n\nfunction getManualURL(target) {\n  \n  //var URL \u003d \"https://docs.google.com/spreadsheets/d/1X4UOyJL87Ghkp1PdIqWj0EBVd-Aop8t6VpctlRDndOo/edit#gid\u003d0\"//test\n  var URL \u003d \"https://docs.google.com/spreadsheets/d/14gF_mGaMyxqxowmRM9LTySC4jmbeDqpjdXLIOX6CLxY/edit#gid\u003d0\";\n  \n  var ss \u003d SpreadsheetApp.openByUrl(URL);\n  var Sheet \u003d ss.getActiveSheet();  \n   \n  // (1行目,1列目,　から　最終行,4列　を取得する)\n  var LastRow \u003d Sheet.getLastRow(); \n  var Range \u003d Sheet.getRange(1,1,LastRow,4);\n  var Values \u003d Range.getValues();\n  \n  //全件表示用URL\n  var AllListURL \u003d \"https://docs.google.com/spreadsheets/d/1pyW_-keldEALlUMERMyVvTy-rdAs6xW_EciAyA739Ck/edit#gid\u003d0\";\n  \n  \n  var message \u003d \"検索結果：\"\n  var count \u003d0;\n  var andList \u003d [];\n  var Answer \u003d [];\n  var matchList \u003d [];\n\n   \n   //id検索、完全一致\n  if(target.match(/^#/)){\n    var Id \u003d target;\n    for(var i \u003d 0; i\u003cLastRow; i++){\n      if(String(Values[i][0])\u003d\u003dId){\n        message \u003d \"検索結果：\"\n        message \u003d message+ \"\\n\" + String(Values[i][1]) + \"\\t\" +String(Values[i][2]);\n        break;\n      }else{\n        message \u003d \"IDが間違っています。お確かめの上再度入力してください\";\n        continue;\n      }\n    }\n    return message;\n    //全件表示\n  }else if(target \u003d\u003d \"全件表示\"){\n    \n    /*自動コピー　範囲指定がダメ　A1:C4~ とかだとうまいくいく\n    var OpenList \u003d SpreadsheetApp.openByUrl(AllListURL);\n    var OpenSheet \u003d OpenList.getActiveSheet();\n    //var LastRowOpen \u003d LastRow + 1;\n    var copyValue \u003d Sheet.getRange(\"A1:C4\").getValues();\n    OpenSheet.getRange(\"A2:C5\").setValues(copyValue);\n    //count++;*//*\n    \n    message \u003d \"全件リストを表示します\" + \"\\n\" + AllListURL;\n    return　message;\n    \n  }else{\n    //AND・単一統合\n    //検索ワードリスト\n    if(/\\s+/.test(target)){\n      andList \u003d target.split(/\\s+/);\n    }else{\n      andList.push(target);\n    }\n\n    for(var i \u003d0; i\u003cLastRow; i++){\n      //検索対象リストをつくる\n      var Keyword_List \u003d String(Values[i][3]).split(\",\");\n      Keyword_List.unshift(String(Values[i][1]));\n      \n      for(var l \u003d 0; l\u003candList.length; l++){\n        for(var h \u003d 0; h\u003cKeyword_List.length; h++){\n          //判定\n          if(String(Keyword_List[h]).indexOf(andList[l])\u003e-1){\n            //単一検索のとき\n            if(andList.length \u003d\u003d1){\n              Answer.push(i);  \n              var Res \u003d Answer.filter(function (x, y, self) {\n                return self.indexOf(x) \u003d\u003d\u003d y;});\n              //count \u003d Answer.length;\n              \n             //And検索のとき\n            }else{\n              var Res \u003d Answer.filter(function (x, y, self) {\n                return self.indexOf(x) \u003d\u003d\u003d y;});\n              matchList.push(i);\n              Answer \u003d matchList.filter(function (e, f, self) {\n                return self.indexOf(e) \u003d\u003d\u003d f \u0026\u0026 f !\u003d\u003d self.lastIndexOf(e); });\n              //count \u003d Answer.length;\n            }\n            /*count \u003d Answer.length;\n            if(count\u003e10){\n              message \u003d \"検索結果をIDで表示します\";\n              }\n          }\n        }\n      }\n      continue;\n    }\n    \n    //配列の重複を削除(同じ項目に含まれる複数のキーワードがヒットしたとき用)\n    \n    var messageAnswer \u003d Answer.filter(function (x, y, self) {\n      return self.indexOf(x) \u003d\u003d\u003d y;});\n    \n    \n    count \u003d messageAnswer.length;\n    /*if(count\u003e10){\n      message \u003d \"検索結果をIDで表示します\";\n    }*//*\n    \n    \n    //メッセージ処理\n    if(count \u003e10){\n      message \u003d \"検索結果をIDで表示します\";\n      for(var q \u003d0; q\u003c messageAnswer.length; q++){\n        var j \u003d messageAnswer[q];\n        message \u003d message + (\"\\n\")+ String(Values[j][0]) + \"\\t\" + String(Values[j][2]);\n      }\n    }else if(count \u003c 1){\n      message \u003d message;\n    }else{\n      for(var q \u003d0; q\u003c messageAnswer.length; q++){\n        var j \u003d messageAnswer[q];\n        message \u003d message + \"\\n\" + String(Values[j][1]) + \"\\t\" + String(Values[j][2]);}\n    }\n  }  \n  if(count\u003c1){\n    message \u003d message + \"なし\";\n  }\n  Logger.log(\"最終：\"+ message);\n  return message;\n  \n\n    \n}*/"}]}